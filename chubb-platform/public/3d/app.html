<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture & S√©curit√© 3D - Pro</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Three.js & Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>

    <div id="canvas-container"></div>
    <div id="toast-msg"><i class="fas fa-info-circle"></i> <span id="toast-text">Mode Actif</span></div>

    <div id="controls">
        <div class="tabs">
            <!-- Device Toggle PC/iPad -->
            <div id="device-toggle" class="device-toggle">
                <button id="btn-mode-pc" class="device-btn active" onclick="setDeviceMode('pc')"
                    title="Mode PC - Souris + Clavier">
                    <span>üíª</span> PC
                </button>
                <button id="btn-mode-tablet" class="device-btn" onclick="setDeviceMode('tablet')"
                    title="Mode iPad - Stylet + Tactile">
                    <span>üì±</span> iPad
                </button>
            </div>
            <div class="tabs-separator"></div>
            <div id="btn-tab-arch" class="tab-btn active" onclick="switchTab('arch')"><i class="fas fa-layer-group"></i>
                Archi</div>
            <div id="btn-tab-furn" class="tab-btn" onclick="switchTab('furn')"><i class="fas fa-couch"></i> Am√©nagement
            </div>
            <div id="btn-tab-det" class="tab-btn" onclick="switchTab('det')"><i class="fas fa-shield-alt"></i> S√©curit√©
            </div>
            <div id="btn-tab-ext" class="tab-btn" onclick="switchTab('ext')"><i class="fas fa-fire-extinguisher"></i>
                Extinction</div>
            <div id="btn-tab-render" class="tab-btn" onclick="switchTab('render')"><i class="fas fa-palette"></i>
                Rendu</div>
        </div>

        <!-- Tab 1: Architecture -->
        <div id="tab-arch" class="tab-content">
            <div class="control-group">
                <h3><i class="fas fa-ruler-combined"></i> Dimensions Salle</h3>
                <label>Longueur (m) <input type="number" id="dim-l" value="10" step="0.5"
                        onchange="updateBuilding()"></label>
                <label>Largeur (m) <input type="number" id="dim-w" value="8" step="0.5"
                        onchange="updateBuilding()"></label>
            </div>
            <div class="control-group">
                <h3><i class="fas fa-layer-group"></i> Hauteurs (m)</h3>
                <label>Faux-Plancher <input type="number" id="h-fp" value="0.5" step="0.1"
                        onchange="updateBuilding()"></label>
                <label>Ambiance <input type="number" id="h-amb" value="3.0" step="0.1"
                        onchange="updateBuilding()"></label>
                <label>Faux-Plafond <input type="number" id="h-fc" value="0.5" step="0.1"
                        onchange="updateBuilding()"></label>
            </div>
            <div class="control-group">
                <h3><i class="fas fa-door-open"></i> Portes & Fen√™tres</h3>
                <label>Type Porte
                    <select id="door-type">
                        <option value="single">Simple (0.9m)</option>
                        <option value="double">Double (1.8m)</option>
                    </select>
                </label>
                <div class="flex gap-2 mt-2">
                    <button class="btn-primary flex-1" id="btn-place-door" onclick="toggleDoorMode()"><i
                            class="fas fa-plus"></i> Placer
                        Porte</button>
                    <button class="btn-danger" id="btn-delete-door" onclick="toggleDeleteMode()"><i
                            class="fas fa-eraser"></i></button>
                </div>
                <div class="mt-2 text-xs text-gray-400">
                    <label class="flex items-center"><input type="checkbox" id="snap-door-angle" checked> Snap
                        90¬∞</label>
                </div>
                <div id="door-list" class="item-list mt-2"></div>
            </div>
            <div class="control-group">
                <h3><i class="fas fa-eye"></i> Visibilit√©</h3>
                <label><input type="checkbox" id="vis-fp" checked onchange="updateBuilding()"> Faux-Plancher</label>
                <label><input type="checkbox" id="vis-amb" checked onchange="updateBuilding()"> Ambiance</label>
                <label><input type="checkbox" id="vis-fc" checked onchange="updateBuilding()"> Faux-Plafond</label>
                <label><input type="checkbox" id="vis-labels" checked onchange="toggleLabels()"> Afficher
                    √âtiquettes</label>
            </div>
            <div class="mt-2 text-xs text-gray-400">
                <p>Volume Total (Est.): <span id="vol-total" class="font-bold">0</span> m¬≥</p>
            </div>
        </div>

        <!-- Tab 2: Furniture -->
        <div id="tab-furn" class="tab-content hidden">
            <div class="control-group">
                <h3><i class="fas fa-project-diagram"></i> Cas d'Usage</h3>
                <select id="use-case" onchange="updateUseCaseUI(); updateBuilding();">
                    <option value="none">Vide</option>
                    <option value="datacenter">Data Center</option>
                    <option value="ehpad">EHPAD / H√¥pital</option>
                    <option value="hotel">H√¥tel</option>
                </select>
            </div>

            <!-- Data Center Controls -->
            <div id="controls-datacenter" class="hidden">
                <div class="control-group">
                    <h3>Configuration Baies</h3>
                    <label>Largeur Baie (m) <input type="number" id="dc-w" value="0.6" step="0.1"
                            onchange="updateBuilding()"></label>
                    <label>Profondeur Baie (m) <input type="number" id="dc-d" value="1.0" step="0.1"
                            onchange="updateBuilding()"></label>
                    <label>Hauteur Baie (m) <input type="number" id="dc-h" value="2.0" step="0.1"
                            onchange="updateBuilding()"></label>
                    <label>All√©e (m) <input type="number" id="dc-gap" value="1.2" step="0.1"
                            onchange="updateBuilding()"></label>
                    <label>Nb Rang√©es (0=Auto) <input type="number" id="dc-rows-count" value="0"
                            onchange="updateBuilding()"></label>
                    <label>Baies/Rang√©e (0=Auto) <input type="number" id="dc-racks-per-row" value="0"
                            onchange="updateBuilding()"></label>
                </div>
            </div>

            <!-- EHPAD Controls -->
            <div id="controls-ehpad" class="hidden">
                <div class="control-group">
                    <h3>Configuration Chambres</h3>
                    <label>Largeur Ch. (m) <input type="number" id="ehpad-room-x" value="4"
                            onchange="updateBuilding()"></label>
                    <label>Prof. Ch. (m) <input type="number" id="ehpad-room-z" value="5"
                            onchange="updateBuilding()"></label>
                    <label>Type Lit
                        <select id="ehpad-bed-type" onchange="updateBuilding()">
                            <option value="std">Standard</option>
                            <option value="pmr">M√©dicalis√© (PMR)</option>
                        </select>
                    </label>
                </div>
            </div>

            <!-- Hotel Controls -->
            <div id="controls-hotel" class="hidden">
                <div class="control-group">
                    <h3>Configuration Suites</h3>
                    <label>Largeur (m) <input type="number" id="hotel-x" value="5" onchange="updateBuilding()"></label>
                    <label>Profondeur (m) <input type="number" id="hotel-z" value="6"
                            onchange="updateBuilding()"></label>
                </div>
            </div>
        </div>

        <!-- Tab 3: Detection -->
        <div id="tab-det" class="tab-content hidden">
            <div class="control-group">
                <h3><i class="fas fa-satellite-dish"></i> Type D√©tection</h3>
                <select id="det-type" onchange="updateDetectionUI(); updateDetection();">
                    <option value="optical">D√©tecteurs Optiques (Ponctuels)</option>
                    <option value="vesda">Aspiration (VESDA)</option>
                </select>
            </div>

            <!-- Optical Controls -->
            <div id="controls-optical">
                <div class="control-group">
                    <h3>Placement Manuel</h3>
                    <label>Niveau
                        <select id="opt-layer-select">
                            <option value="amb">Ambiance (Plafond)</option>
                            <option value="fp">Faux-Plancher</option>
                            <option value="fc">Faux-Plafond</option>
                        </select>
                    </label>
                    <div class="flex gap-2 mt-2">
                        <button class="btn-primary flex-1" id="btn-place-det" onclick="toggleOpticalMode()"><i
                                class="fas fa-plus-circle"></i> Ajouter</button>
                        <button class="btn-danger" id="btn-delete-det" onclick="toggleDeleteMode()"><i
                                class="fas fa-eraser"></i></button>
                    </div>
                    <div class="mt-2 text-xs text-gray-400">
                        <label><input type="checkbox" id="snap-toggle-opt" checked> Grille 0.5m</label>
                        <span id="cursor-coords-opt" class="ml-2"></span>
                    </div>
                </div>
                <div class="control-group">
                    <h3>Liste D√©tecteurs</h3>
                    <div id="detector-list" class="item-list"></div>
                </div>
            </div>

            <!-- VESDA Controls -->
            <div id="controls-vesda" class="hidden">
                <div class="control-group">
                    <h3>Unit√©s VESDA</h3>
                    <div class="flex gap-2">
                        <button class="btn-primary flex-1" id="btn-place-vesda" onclick="toggleVesdaMode()"><i
                                class="fas fa-box"></i> Placer un VESDA</button>
                        <button class="btn-danger" id="btn-delete-vesda" onclick="toggleDeleteMode()"><i
                                class="fas fa-eraser"></i></button>
                    </div>
                    <div class="mt-2 text-xs text-gray-400">
                        <label><input type="checkbox" id="snap-toggle-vesda" checked> Snap Mur</label>
                        <span id="cursor-coords-vesda" class="ml-2"></span>
                    </div>
                </div>
                <div class="control-group">
                    <h3>Liste VESDA</h3>
                    <div id="vesda-list" class="item-list"></div>
                    <button class="btn-secondary w-full mt-2" onclick="clearVesdas()">Tout Effacer</button>
                </div>
                <div class="control-group">
                    <h3>R√©seau d'aspiration</h3>
                    <label><input type="checkbox" id="vesda-layer-fc" onchange="updateDetection()"> Faux-Plafond</label>
                    <label><input type="checkbox" id="vesda-layer-amb" checked onchange="updateDetection()">
                        Ambiance</label>
                    <label><input type="checkbox" id="vesda-layer-fp" onchange="updateDetection()">
                        Faux-Plancher</label>
                </div>
            </div>
        </div>

        <!-- Tab 4: Extinction -->
        <div id="tab-ext" class="tab-content hidden">
            <div class="control-group">
                <h3><i class="fas fa-fire-extinguisher"></i> Syst√®me Extinction</h3>
                <select id="ext-type" onchange="updateExtinctionUI(); fetchGasCalculation();">
                    <option value="none">Aucun</option>
                    <option value="ig55">Gaz Inerte (IG55)</option>
                    <option value="hifog">Brouillard d'Eau (Hi-Fog)</option>
                </select>
            </div>

            <div class="mt-4 mb-4">
                <button class="btn-primary w-full" onclick="generateReport()">
                    <i class="fas fa-file-pdf"></i> T√©l√©charger Rapport PDF
                </button>
            </div>

            <!-- IG55 Controls -->
            <div id="controls-ig55" class="hidden">
                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <p>Calcul auto: 1 bouteille / 30m¬≤ (Backend Python).</p>
                </div>
            </div>

            <!-- Hi-Fog Controls -->
            <div id="controls-hifog" class="hidden">
                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <p>Calcul selon r√®gle : Tank bas√© sur surface (div 16).</p>
                </div>
            </div>

            <div id="ext-results" class="result-box hidden mt-4">
                <h4><i class="fas fa-calculator"></i> Dimensionnement</h4>
                <div id="ext-details"></div>
            </div>

            <div id="gas-results" class="result-box mt-4">
                <h4><i class="fas fa-flask"></i> D√©tails Gaz (Backend)</h4>
                <div id="gas-results-content" class="text-sm">En attente...</div>
            </div>
        </div>

        <!-- Tab 5: Rendering -->
        <div id="tab-render" class="tab-content hidden">
            <div class="control-group">
                <h3><i class="fas fa-magic"></i> Mode Rendu</h3>
                <button class="btn-primary w-full" id="btn-render" onclick="toggleRenderMode()">
                    <i class="fas fa-eye"></i> Activer Rendu R√©aliste
                </button>
            </div>

            <div class="control-group">
                <h3><i class="fas fa-cubes"></i> Mat√©riaux Structure</h3>
                <label>Murs
                    <select id="mat-walls" onchange="updateMaterialPreview()">
                        <option value="plaster">Pl√¢tre blanc</option>
                        <option value="concrete">B√©ton brut</option>
                        <option value="brick">Brique</option>
                        <option value="glass">Verre</option>
                        <option value="metal">M√©tal bross√©</option>
                    </select>
                </label>
                <label>Sol
                    <select id="mat-floor" onchange="updateMaterialPreview()">
                        <option value="tile">Carrelage</option>
                        <option value="wood">Parquet bois</option>
                        <option value="carpet">Moquette</option>
                        <option value="concrete">B√©ton cir√©</option>
                        <option value="epoxy">R√©sine √©poxy</option>
                    </select>
                </label>
                <label>Plafond
                    <select id="mat-ceiling" onchange="updateMaterialPreview()">
                        <option value="plaster">Pl√¢tre blanc</option>
                        <option value="metal">Dalles m√©tal</option>
                        <option value="wood">Bois</option>
                    </select>
                </label>
                <label>Portes
                    <select id="mat-doors" onchange="updateMaterialPreview()">
                        <option value="wood">Bois massif</option>
                        <option value="metal">M√©tal</option>
                        <option value="glass">Verre</option>
                        <option value="fire">Coupe-feu (gris)</option>
                    </select>
                </label>
            </div>

            <div class="control-group">
                <h3><i class="fas fa-shield-alt"></i> Mat√©riaux D√©tection</h3>
                <label>D√©tecteurs
                    <select id="mat-detectors" onchange="updateMaterialPreview()">
                        <option value="white">Plastique blanc</option>
                        <option value="gray">Plastique gris</option>
                        <option value="chrome">Chrome</option>
                    </select>
                </label>
                <label>Bo√Ætiers VESDA
                    <select id="mat-vesda" onchange="updateMaterialPreview()">
                        <option value="black">M√©tal noir</option>
                        <option value="gray">M√©tal gris</option>
                        <option value="red">Rouge Chubb</option>
                    </select>
                </label>
                <label>Tubes VESDA
                    <select id="mat-vesdapipe" onchange="updateMaterialPreview()">
                        <option value="red">PVC rouge</option>
                        <option value="gray">PVC gris</option>
                        <option value="copper">Cuivre</option>
                    </select>
                </label>
            </div>

            <div class="control-group">
                <h3><i class="fas fa-fire-extinguisher"></i> Mat√©riaux Extinction</h3>
                <label>Bouteilles IG55
                    <select id="mat-cylinders" onchange="updateMaterialPreview()">
                        <option value="green">Acier vert</option>
                        <option value="steel">Inox bross√©</option>
                        <option value="black">Noir mat</option>
                    </select>
                </label>
                <label>Tuyauterie
                    <select id="mat-pipes" onchange="updateMaterialPreview()">
                        <option value="black">Acier noir</option>
                        <option value="galva">Galvanis√©</option>
                        <option value="copper">Cuivre</option>
                        <option value="stainless">Inox</option>
                    </select>
                </label>
                <label>Buses/Nozzles
                    <select id="mat-nozzles" onchange="updateMaterialPreview()">
                        <option value="chrome">Chrome</option>
                        <option value="brass">Laiton</option>
                        <option value="stainless">Inox</option>
                    </select>
                </label>
            </div>

            <div class="control-group">
                <h3><i class="fas fa-couch"></i> Mat√©riaux Mobilier</h3>
                <label>Baies/Racks
                    <select id="mat-racks" onchange="updateMaterialPreview()">
                        <option value="black">M√©tal noir</option>
                        <option value="gray">M√©tal gris</option>
                        <option value="white">Blanc</option>
                    </select>
                </label>
                <label>Lits (structure)
                    <select id="mat-beds" onchange="updateMaterialPreview()">
                        <option value="wood">Bois</option>
                        <option value="metal">M√©tal blanc</option>
                        <option value="chrome">Chrome m√©dical</option>
                    </select>
                </label>
            </div>

            <div class="control-group">
                <h3><i class="fas fa-sun"></i> √âclairage</h3>
                <label>Intensit√©
                    <input type="range" id="light-intensity" min="0.2" max="2" step="0.1" value="1"
                        onchange="updateLighting()">
                    <span id="light-value">1.0</span>
                </label>
                <label>Temp√©rature
                    <select id="light-temp" onchange="updateLighting()">
                        <option value="warm">Chaud (3000K)</option>
                        <option value="neutral" selected>Neutre (4500K)</option>
                        <option value="cool">Froid (6500K)</option>
                    </select>
                </label>
            </div>
        </div>

    </div>

    <!-- jsPDF & AutoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <!-- App Logic -->
    <script src="assets/js/app.js" defer></script>
    <script src="assets/js/report.js" defer></script>
</body>

</html>